<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf8" />
<title>File: TAP-YJ</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html" title="Index">Index</a> &raquo; 
    <span class="title">File: TAP-YJ</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><div id='filecontents'>
<h1>TAP-Y/J Format</h1>

<p>TAP-Y and TAP-J are test streams. They are essentially the same except for
the underlying format used, which are YAML and JSON repsectively.</p>

<h2>TAP-Y Structure</h2>

<p>TAP-Y is a plain YAML stream format. Only YAML core types are used, 
scalar, sequence and mapping.</p>

<p>A YAML stream is composed a sequence of YAML <b>documents</b>, each divided
by a start document marker (<tt>---</tt>). Each document MUST have a
<tt>type</tt> field which designates it a <tt>header</tt>, <tt>case</tt>,
<tt>test</tt>, <tt>note</tt> or <tt>footer</tt>. Any document MAY have an
<tt>extra</tt> field which contains an open mapping for extraneous
information.</p>

<h3>Header</h3>

<p>A <tt>header</tt> starts a stream of tests.</p>

<pre class="code"><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='header identifier id'>header</span>
<span class='start identifier id'>start</span><span class='colon op'>:</span> <span class='integer val'>2011</span><span class='minus op'>-</span><span class='integer val'>10</span><span class='minus op'>-</span><span class='integer val'>10</span> <span class='integer val'>12</span><span class='symbol val'>:12</span><span class='symbol val'>:32</span>
<span class='count identifier id'>count</span><span class='colon op'>:</span> <span class='integer val'>2</span>
<span class='range identifier id'>range</span><span class='colon op'>:</span> <span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>2</span>
</pre>

<p>The header <tt>count</tt> indicates the number of total tests forethcoming.
If the number of tests is unknow, count can be omitted or marked
<tt>~</tt>.</p>

<p>The <tt>range</tt> defines the index of tests to be run separated by two
period marks. The range will usually start with 1, but may start with
another number if the underlying test system index tests.</p>

<p>The <tt>start</tt> entry marks the date and time testing began.</p>

<h3>Case</h3>

<p>The <tt>case</tt> type indicates the start of a test case.</p>

<pre class="code"><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='case case kw'>case</span>
<span class='description identifier id'>description</span><span class='colon op'>:</span> <span class='Subtraction constant id'>Subtraction</span>
</pre>

<p>The case docoument has a  <tt>description</tt> that is a free-form string
describing the nature of the test case.</p>

<h3>Test</h3>

<p>The <tt>test</tt> type indicates a test. A test MUST have a <tt>status</tt>
with one of five possible values: <tt>pass</tt>, <tt>fail</tt>,
<tt>error</tt>, <tt>omit</tt>, <tt>pending</tt>.</p>

<pre class="code"><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='test identifier id'>test</span>
<span class='status identifier id'>status</span><span class='colon op'>:</span> <span class='pass identifier id'>pass</span>
<span class='description identifier id'>description</span><span class='colon op'>:</span> <span class='an identifier id'>an</span> <span class='important identifier id'>important</span> <span class='test identifier id'>test</span>
<span class='file identifier id'>file</span><span class='colon op'>:</span> <span class='foo identifier id'>foo</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
<span class='line identifier id'>line</span><span class='colon op'>:</span> <span class='integer val'>45</span>
<span class='returned identifier id'>returned</span><span class='colon op'>:</span> <span class='true true kw'>true</span>
<span class='expected identifier id'>expected</span><span class='colon op'>:</span> <span class='true true kw'>true</span>
<span class='source identifier id'>source</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>2</span>
<span class='snippet identifier id'>snippet</span><span class='colon op'>:</span>
  <span class='minus op'>-</span> <span class='integer val'>44</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>0</span>
  <span class='minus op'>-</span> <span class='integer val'>45</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>2</span>
  <span class='minus op'>-</span> <span class='integer val'>46</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>2</span><span class='comma token'>,</span><span class='integer val'>4</span>
<span class='time identifier id'>time</span><span class='colon op'>:</span> <span class='integer val'>0</span><span class='integer val'>.01</span>
</pre>

<p>Like a case, the test can have a <tt>description</tt>.</p>

<p>A test SHOULD also have a <tt>file</tt> and <tt>line</tt> number for the
location of of the definition of the test, when <tt>pass</tt> or
<tt>omit</tt>, or the location of the exception when <tt>fail</tt> or
<tt>error</tt>. A <tt>pending</tt> test will give the location of one or
the other depending on how the underlying test system behaves.</p>

<p>If a test fails or errors it MUST also provide a <tt>message</tt>
describing the nature of the exception. It MAY also provide a system
<tt>backtrace</tt>.</p>

<p>A test SHOULD also give an <tt>expected</tt> and <tt>returned</tt> value,
if relavent to the nature of the test. For example, the most common test
operation is equality, e.g. <tt>assert_equal(4,3)</tt>, so
<tt>expected</tt> would be 3 and <tt>returned</tt> 4.</p>

<p>A test SHOULD provide the line of <tt>source</tt> code that triggers the
test. This will be the line of code the <tt>file</tt> and <tt>line</tt>
number references.</p>

<p>The <tt>snippet</tt> is like <tt>source</tt> but provides surronding
context. It MAY be a verbatim string, in which case it MUST have an odd
number of lines with the source line in the center. Or, it MAY be an
ordered map of  <em>- line: source</em>. Using an ordered map the line
numbers may start and end wherever, but they MUST be consecutive and the
source line MUST be among them.</p>

<p>Lastly, the <tt>time</tt> is the number of seconds that have elapsed since
the the header start time.</p>

<h3>Footer</h3>

<p>The <tt>footer</tt> type incidates the end of a test set.</p>

<pre class="code"><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='footer identifier id'>footer</span>
<span class='count identifier id'>count</span><span class='colon op'>:</span> <span class='integer val'>2</span>
<span class='tally identifier id'>tally</span><span class='colon op'>:</span>
  <span class='pass identifier id'>pass</span><span class='colon op'>:</span> <span class='integer val'>1</span>
  <span class='fail identifier id'>fail</span><span class='colon op'>:</span> <span class='integer val'>1</span>
  <span class='error identifier id'>error</span><span class='colon op'>:</span> <span class='integer val'>0</span>
  <span class='omit identifier id'>omit</span><span class='colon op'>:</span> <span class='integer val'>0</span>
  <span class='pending identifier id'>pending</span><span class='colon op'>:</span> <span class='integer val'>0</span>
<span class='time identifier id'>time</span><span class='colon op'>:</span> <span class='integer val'>0</span><span class='integer val'>.03</span>
<span class='dot3 op'>...</span>
</pre>

<p>It MUST give the total test <tt>count</tt> and <tt>tally</tt> for each test
status, and SHOULD give the time ellapsed.</p>

<p>The test stream end when a full ellipsis (<tt>...</tt>) appears.</p>

<p>As you can see TAP-Y streams provide a great deal of detail. They are not
intended for the end-user, but rather to pipe to consuming apps to process
into a human readable form.</p>

<h2>TAP-J</h2>

<p>TAP-J documents follows all the same feild rules as TAP-Y, but are
represented as a stream of JSON documents.</p>

<pre class="code"><span class='lbrace token'>{</span><span class='string val'>&quot;type&quot;</span><span class='symbol val'>:&quot;header&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;count&quot;</span><span class='symbol val'>:&quot;2&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;range&quot;</span><span class='symbol val'>:&quot;1..2&quot;</span><span class='rbrace token'>}</span>
<span class='lbrace token'>{</span><span class='string val'>&quot;type&quot;</span><span class='symbol val'>:&quot;case&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;description&quot;</span><span class='symbol val'>:&quot;Subtraction&quot;</span><span class='rbrace token'>}</span>
<span class='lbrace token'>{</span><span class='string val'>&quot;type&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;test&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;status&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;pass&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;file&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;foo.rb&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;line&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;45&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;description&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;an important test&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;returned&quot;</span><span class='colon op'>:</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='string val'>&quot;expected&quot;</span><span class='colon op'>:</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='string val'>&quot;source&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;ok 1, 2&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;snippet&quot;</span><span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='lbrace token'>{</span><span class='integer val'>44</span><span class='symbol val'>:&quot;  ok 0,0&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span><span class='lbrace token'>{</span><span class='integer val'>45</span><span class='symbol val'>:&quot;  ok 1,2&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span><span class='lbrace token'>{</span><span class='integer val'>46</span><span class='symbol val'>:&quot;  ok 2,4&quot;</span><span class='rbrace token'>}</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='string val'>&quot;time&quot;</span><span class='colon op'>:</span> <span class='integer val'>0</span><span class='integer val'>.01</span><span class='rbrace token'>}</span>

<span class='dot3 op'>...</span>
</pre>

<p>Ans so on.</p>

<h2>Glossery of Fields</h2>

<h3>count</h3>

<p>The `count` field provides the total number of tests being executed. It
SHOULD be given in the header, if possible, and it MUST be given in the
footer.</p>

<h3>extra</h3>

<p>Additional data, not specifucally designated by this sepecification can
place under the `extra` section without worry that future versions of the
specification will come into conflict with the field name. The namespace is
a free-for-all, so use it with that in mind. Teh `extra` field can  appear
in any document.</p>

<h3>file</h3>

<p>The `file` field provides the name of the file in which the test is
defined, or where th test failed/errored.</p>

<h3>line</h3>

<p>The `line` field provides the line number of the file on which the
definition of the test begins, or is the line number of where the  test
failed/errored.</p>

<h3>message</h3>

<p>For tests with `fail` or `error` status, the message provides the
explination for the failure or error. Usually this is just the error
message produced by the underlying exception. The `pass` type can have the
message field too, but it will generally be ignored by TAP consumers.</p>

<h3>range</h3>

<p>The range of tests being executed of the test suite. The range is written
in the form of `X..Y`. Where X is the index of the first test and Y is the
index of last test.</p>

<p>NOTE: This may be deprecated since the count field probably suffices. Can a
range uniquely identify the tests being run? If not, the first sentinal
will always be 1, which is redundant.</p>

<h3>snippet</h3>

<p>The `snippet` field is either a verbatim string or an ordered mapping of
line number mapped to the source code for that line. While `snippet` is
like `source` it also contains extra lines of code before and after the
test `line` for context.</p>

<p>If `snippet` is a string it MUST consist an odd number of lines, the same
number before and after the source line in the center, unless the line
occurs at the begining or the end of the file. The number of lines before
and after is arbitrary and up to the producer, but should be the same on
either side. Three to five is generally enough.</p>

<h3>source</h3>

<p>The `source` field is a verbatim copy of the source code that defines the
test. This may be just the first line of the definition. In classic TAP
this is called `raw_test`.</p>

<h3>start</h3>

<p>The header SHOULD have a start time in ISO standard format <tt>YYYY-MM-DD
HH:MM:SS</tt>.</p>

<h3>status</h3>

<p>The `status` field designates the status of a test document. Valid values
are `pass`, `fail`, `error`, `omit` and `pending`.</p>

<p>In comparison to the classic TAP format, `pass` is equivalent to `ok` and 
`fail` and `error` are akin to `not ok`, where `fail` is “not ok” with
regards to a test assertion and `error` is “not ok” becuase of a raised
coding error.</p>

<p>Tests with an `omit` status do not need to be provided in the document
stream, so this status will rarely appear in practice. But if a producer
chooses to do so this status simply means the test is purposefully being
disregarded.</p>

<p>On the other hand, `pending` means the test will be used in the future but
implementation has not been completed. It serves as reminder to developers
to write a missing test.</p>

<h3>tally</h3>

<p>The footer MUST provide a tally for all status categories. This is like
`count` but broken down into status groups.</p>

<h3>time</h3>

<p>The tests and the footer SHOULD have the <tt>time</tt> elapsed since
starting the  tests given in number of seconds.</p>

<h3>type</h3>

<p>Each document MUST have a <b>type</b>. Valid types are `header`, `footer`,
`case`, `test` and `note`.</p>

<p>The `header` and `footer` types can only occur once, at the start and end
of the stream, respectively. All other types may occur repeatedly in
between.</p>

<p>The `case` type marks the start of a testcase. All `test` (and `note`) 
documents following it are considered a part of the case until a new case
document occurs.</p>

<h2>Example - Complete TAP-Y Stream</h2>

<p>Here is a complete example.</p>

<p>An example of a TAP-Y stream looks like this:</p>

<pre class="code"><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='header identifier id'>header</span>
<span class='count identifier id'>count</span><span class='colon op'>:</span> <span class='integer val'>2</span>
<span class='range identifier id'>range</span><span class='colon op'>:</span> <span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>2</span>
<span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='case case kw'>case</span>
<span class='description identifier id'>description</span><span class='colon op'>:</span> <span class='Subtraction constant id'>Subtraction</span>
<span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='test identifier id'>test</span>
<span class='status identifier id'>status</span><span class='colon op'>:</span> <span class='pass identifier id'>pass</span>
<span class='file identifier id'>file</span><span class='colon op'>:</span> <span class='foo identifier id'>foo</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
<span class='line identifier id'>line</span><span class='colon op'>:</span> <span class='integer val'>45</span>
<span class='description identifier id'>description</span><span class='colon op'>:</span> <span class='an identifier id'>an</span> <span class='important identifier id'>important</span> <span class='test identifier id'>test</span>
<span class='returned identifier id'>returned</span><span class='colon op'>:</span> <span class='true true kw'>true</span>
<span class='expected identifier id'>expected</span><span class='colon op'>:</span> <span class='true true kw'>true</span>
<span class='source identifier id'>source</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>2</span>
<span class='snippet identifier id'>snippet</span><span class='colon op'>:</span>
  <span class='minus op'>-</span> <span class='integer val'>44</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>0</span>
  <span class='minus op'>-</span> <span class='integer val'>45</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>2</span>
  <span class='minus op'>-</span> <span class='integer val'>46</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>2</span><span class='comma token'>,</span><span class='integer val'>4</span>
<span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='test identifier id'>test</span>
<span class='status identifier id'>status</span><span class='colon op'>:</span> <span class='fail identifier id'>fail</span>
<span class='file identifier id'>file</span><span class='colon op'>:</span> <span class='foo identifier id'>foo</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
<span class='line identifier id'>line</span><span class='colon op'>:</span> <span class='integer val'>46</span>
<span class='description identifier id'>description</span><span class='colon op'>:</span> <span class='another identifier id'>another</span> <span class='test identifier id'>test</span>
<span class='returned identifier id'>returned</span><span class='colon op'>:</span> <span class='false false kw'>false</span>
<span class='expected identifier id'>expected</span><span class='colon op'>:</span> <span class='true true kw'>true</span>
<span class='source identifier id'>source</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>2</span><span class='comma token'>,</span><span class='integer val'>4</span>
<span class='snippet identifier id'>snippet</span><span class='colon op'>:</span>
  <span class='minus op'>-</span> <span class='integer val'>45</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>2</span>
  <span class='minus op'>-</span> <span class='integer val'>46</span><span class='colon op'>:</span> <span class='ok identifier id'>ok</span> <span class='integer val'>2</span><span class='comma token'>,</span><span class='integer val'>4</span>
  <span class='minus op'>-</span> <span class='integer val'>47</span><span class='colon op'>:</span>
<span class='message identifier id'>message</span><span class='colon op'>:</span>
  <span class='blah identifier id'>blah</span> <span class='blah identifier id'>blah</span>
<span class='extra identifier id'>extra</span><span class='colon op'>:</span>
  <span class='THAC0 constant id'>THAC0</span><span class='colon op'>:</span> <span class='integer val'>16</span>
<span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='type identifier id'>type</span><span class='colon op'>:</span> <span class='footer identifier id'>footer</span>
<span class='time identifier id'>time</span><span class='colon op'>:</span> <span class='integer val'>0</span><span class='integer val'>.01</span>
<span class='count identifier id'>count</span><span class='colon op'>:</span> <span class='integer val'>2</span>
<span class='tally identifier id'>tally</span><span class='colon op'>:</span>
  <span class='pass identifier id'>pass</span><span class='colon op'>:</span> <span class='integer val'>1</span>
  <span class='fail identifier id'>fail</span><span class='colon op'>:</span> <span class='integer val'>1</span>
  <span class='error identifier id'>error</span><span class='colon op'>:</span> <span class='integer val'>0</span>
  <span class='omit identifier id'>omit</span><span class='colon op'>:</span> <span class='integer val'>0</span>
  <span class='pending identifier id'>pending</span><span class='colon op'>:</span> <span class='integer val'>0</span>
<span class='dot3 op'>...</span>
</pre>
</div></div>
    
    <div id="footer">
  Generated on Sat May 21 16:28:30 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.7 (ruby-1.8.7).
</div>

  </body>
</html>